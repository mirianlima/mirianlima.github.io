{
  "hash": "52f10a71f52146de67087df75393bb8a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"DuckDB & Motherduck\"\ndescription: \"Testing the use of the DuckDB & Motherduck duo for data transformation\"\ndate: 10-23-2022\ncategories: [Quarto, DuckDB, R, Motherduck, ETL]\ncitation: \n  url: https://mirianlima.github.io/posts/2024-08-12-duckdb-motherduck\nimage: colors.jpg\ndraft: false\neditor_options: \n  chunk_output_type: console\nengine: knitr\njupyter:\n  kernel: python3\n  python: /Users/mlima/miniconda3/envs/eda/bin/python\n---\n\n::: {.cell filename='[R code]'}\n\n```{.r .cell-code}\npacman::p_load(\n  tidyverse,\n  duckdb,\n  janitor,\n  reticulate\n)\n\n# /Users/mlima/miniconda3/envs/eda/bin/python\nuse_miniconda(\"eda\")\n```\n:::\n\n\n\n# Step 1: \nConnect to DuckDB (in-memory by default, or specify a file path)\n\n\n\n::: {.cell filename='[python code]'}\n\n```{.python .cell-code}\nimport duckdb\n# Initialize DuckDB connection\ncon = duckdb.connect()\n\n# Define the base path\nbase_path = '/Users/mlima/Code/mirianlima.github.io/blog/posts/2024-08-12-duckdb-motherduck/data/'\n```\n:::\n\n\n\n# Step 2: \nLoad CSV data into DuckDB using Relations\n\n\n\n::: {.cell filename='[python code]'}\n\n```{.python .cell-code}\nc_age1 = con.read_csv(f'{base_path}c_age1.csv')\nc_dem = con.read_csv(f'{base_path}c_dem.csv')\n```\n:::\n\n\n\n# Step 3: \nFilter, group, aggregate and pivot wide the `c_age1` data using Relations\n\n\n\n::: {.cell filename='[python code]'}\n\n```{.python .cell-code}\nagg_age_data = (\n  c_age1\n  .filter(\"age_labor IN ('Younger Prime-age Workers (25-34)', 'Older Prime-age Workers (35-54)')\")\n  .project(\"\"\"\n      iso3_code, \n      time,\n      CASE \n          WHEN age_labor = 'Younger Prime-age Workers (25-34)' THEN 'prime_younger'\n          WHEN age_labor = 'Older Prime-age Workers (35-54)' THEN 'prime_older'\n      END AS age_labor_group,\n      pop_total\n  \"\"\")\n  .aggregate(\"\"\"\n      iso3_code, \n      time, \n      age_labor_group, \n      SUM(pop_total) AS total_population\n  \"\"\")\n  .aggregate(\"\"\"\n      iso3_code, \n      time,\n      SUM(CASE WHEN age_labor_group = 'prime_younger' THEN total_population ELSE 0 END) AS prime_younger,\n      SUM(CASE WHEN age_labor_group = 'prime_older' THEN total_population ELSE 0 END) AS prime_older\n  \"\"\")\n )\n \nagg_age_data.limit(6).show()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n┌───────────┬───────┬───────────────────┬────────────────────┐\n│ iso3_code │ time  │   prime_younger   │    prime_older     │\n│  varchar  │ int64 │      double       │       double       │\n├───────────┼───────┼───────────────────┼────────────────────┤\n│ MAC       │  2000 │ 69.03000000000002 │ 145.37699999999998 │\n│ MAC       │  2010 │ 90.60699999999999 │ 188.58800000000002 │\n│ MAC       │  2018 │           126.768 │            196.418 │\n│ PRK       │  2004 │          4007.951 │  6264.536999999999 │\n│ AFG       │  2019 │           5104.08 │  5327.619000000001 │\n│ BTN       │  2002 │ 88.89800000000001 │ 107.35999999999999 │\n└───────────┴───────┴───────────────────┴────────────────────┘\n```\n\n\n:::\n:::\n\n\n\n<hr class=\"dashed\">\n\nPhoto by <a href=\"https://unsplash.com/@ro_ka?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\">Robert Katzki</a> on <a href=\"https://unsplash.com/photos/multicolored-wall-in-shallow-focus-photography-jbtfM0XBeRc?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\">Unsplash</a>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}